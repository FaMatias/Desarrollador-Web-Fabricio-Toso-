<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fabricio Matías Toso | Desarrollador y Biotecnólogo</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font-Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0F172A; /* Azul oscuro suave */
            color: #E2E8F0; /* Gris claro para el texto */
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }

        /* Efecto de fondo con un degradado sutil */
        .hero-bg-container {
            background: radial-gradient(circle at top, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 1) 70%);
        }

        /* Estilo de la barra de navegación con blur */
        .navbar-blur {
            background-color: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
        }

        /* Estilo de los botones principales */
        .main-btn {
            background-color: #2563EB; /* Azul profesional */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
        }
        .main-btn:hover {
            background-color: #1E40AF;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(37, 99, 235, 0.4);
        }
        
        /* Estilos de las tarjetas de servicios/proyectos */
        .card {
            background-color: #1e293b; /* Gris oscuro para las tarjetas */
            border: 1px solid #334155; /* Borde sutil */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .api-response-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200">
    
    <!-- Contenido Principal del Sitio Web -->
    <div class="max-w-7xl mx-auto">
        <!-- Barra de navegación -->
        <nav class="fixed top-0 left-0 right-0 z-50 navbar-blur p-4 shadow-md flex items-center justify-between transition-all duration-300">
            <a href="#" class="flex items-center space-x-2 text-sky-400 font-bold text-xl md:text-2xl hover:text-sky-200 transition-colors">
                <i class="fas fa-code fa-lg"></i>
                <span>Fabricio Toso</span>
            </a>
            <div class="flex space-x-4 md:space-x-6">
                <a href="#inicio" class="text-slate-400 hover:text-sky-400 font-semibold transition-colors hidden md:block">Inicio</a>
                <a href="#filosofia" class="text-slate-400 hover:text-sky-400 font-semibold transition-colors hidden md:block">Filosofía</a>
                <a href="#servicios" class="text-slate-400 hover:text-sky-400 font-semibold transition-colors hidden md:block">Servicios</a>
                <a href="#proyectos" class="text-slate-400 hover:text-sky-400 font-semibold transition-colors hidden md:block">Proyectos</a>
                <a href="#ia-hub" class="text-slate-400 hover:text-sky-400 font-semibold transition-colors hidden md:block">IA Hub</a>
                <a href="#contacto" class="text-slate-400 hover:text-sky-400 font-semibold transition-colors hidden md:block">Contacto</a>
            </div>
            <a href="#contacto" class="md:hidden main-btn shadow-lg">
                Contacto
            </a>
        </nav>

        <!-- Sección de Inicio (Hero) -->
        <section id="inicio" class="hero-bg-container flex flex-col items-center justify-center min-h-[100vh] text-center p-6 pt-24">
            <div class="p-8 bg-slate-900 bg-opacity-70 backdrop-blur-sm rounded-2xl shadow-2xl border-2 border-sky-400/20">
                <h1 class="text-4xl md:text-6xl font-extrabold text-sky-400 mb-4 animate-fade-in-down">
                    Hola, soy Fabricio Toso
                </h1>
                <p class="text-lg md:text-2xl text-slate-300 mb-6 font-light">
                    <span id="typing-effect" class="font-bold text-sky-300"></span>
                </p>
                <p class="text-slate-400 max-w-2xl mb-8">
                    Combinando el desarrollo web con la tecnología y la biología para crear soluciones innovadoras.
                </p>
                <a href="#contacto" class="main-btn">
                    ¡Hablemos de tu proyecto!
                </a>
            </div>
        </section>
        <div class="h-1 bg-slate-800 w-full"></div>

        <!-- Nueva Sección: Mi Filosofía de Trabajo -->
        <section id="filosofia" class="py-12 md:py-24 text-center px-4">
            <h2 class="text-3xl md:text-4xl font-extrabold text-sky-400 mb-8">Mi Filosofía de Trabajo</h2>
            <div class="max-w-4xl mx-auto mt-12 text-left bg-slate-800 p-8 rounded-2xl border border-slate-700">
                <p id="filosofia-text" class="text-lg text-slate-300 mb-4">
                    Me adapto a tus necesidades con una <strong>gran relación calidad precio</strong>, con tarifas de programador web para pequeños y medianos negocios. Desarrollo web desde cero o rediseño de tu página web con un diseño moderno y elegante.
                    Con un proyecto web robusto y de calidad, darás una nueva imagen a tu negocio, conseguirás un mayor volumen de negocio con información directa a tus clientes las 24h del día. Te oriento de principio a fin desde las necesidades técnicas hasta la contratación del hosting y dominio, para que tengas tu página web terminada y lista para funcionar «llave en mano».
                    <br><br>
                    <strong>¡Hazte visible en internet!</strong>
                    <br><br>
                    Principalmente realizo proyectos de <strong>Páginas Webs WordPress y Tiendas Online</strong>, seguidos muy de cerca de los servicios de <strong>mantenimiento web y gestión</strong>. También Maquetación de Newsletters HTML, para enviar por email o MailChimp, entre otros muchos proyectos.
                </p>
                <button id="read-aloud-btn" class="main-btn mt-4">
                    <i class="fas fa-volume-up mr-2"></i>✨ Leer en voz alta ✨
                </button>
                <audio id="audio-player" class="mt-4 w-full hidden bg-slate-700 rounded-lg p-2" controls></audio>
            </div>
        </section>
        <div class="h-1 bg-slate-800 w-full"></div>

        <!-- Sección de Servicios -->
        <section id="servicios" class="py-12 md:py-24 text-center px-4">
            <h2 class="text-3xl md:text-4xl font-extrabold text-sky-400 mb-8">Mis Servicios</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-12 max-w-5xl mx-auto">
                <div class="card p-8 rounded-3xl hover:shadow-sky-400/20">
                    <i class="fas fa-desktop fa-3x text-sky-400 mb-4"></i>
                    <h3 class="text-2xl font-bold text-slate-100 mb-2">Desarrollo Web</h3>
                    <p class="text-slate-400">Creación de sitios web a medida, desde landing pages hasta plataformas complejas. Diseño moderno y responsivo garantizado.</p>
                </div>
                <div class="card p-8 rounded-3xl hover:shadow-sky-400/20">
                    <i class="fab fa-wordpress fa-3x text-sky-400 mb-4"></i>
                    <h3 class="text-2xl font-bold text-slate-100 mb-2">Especialista en WordPress</h3>
                    <p class="text-slate-400">Desarrollo y personalización de temas y plugins. Optimización y mantenimiento para un rendimiento óptimo.</p>
                </div>
                <div class="card p-8 rounded-3xl hover:shadow-sky-400/20">
                    <i class="fas fa-mobile-alt fa-3x text-sky-400 mb-4"></i>
                    <h3 class="text-2xl font-bold text-slate-100 mb-2">Aplicaciones Digitales</h3>
                    <p class="text-slate-400">Diseño y construcción de aplicaciones interactivas que resuelven problemas reales y mejoran la experiencia del usuario.</p>
                </div>
            </div>
        </section>
        <div class="h-1 bg-slate-800 w-full"></div>

        <!-- Sección de Proyectos -->
        <section id="proyectos" class="py-12 md:py-24 text-center px-4">
            <h2 class="text-3xl md:text-4xl font-extrabold text-sky-400 mb-8">Mis Proyectos</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12 max-w-5xl mx-auto">
                <a href="https://github.com/FaMatias/Sistema_inventarios" target="_blank" class="card block p-6 rounded-2xl hover:shadow-sky-400/20">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">Sistema de Inventarios</h3>
                    <p class="text-slate-400 mb-4">Un sistema de gestión de inventarios hecho a medida para un cliente.</p>
                    <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-full">Web App</span>
                </a>
                <a href="https://github.com/FaMatias/Vinos_Argentina" target="_blank" class="card block p-6 rounded-2xl hover:shadow-sky-400/20">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">Vinos Argentina</h3>
                    <p class="text-slate-400 mb-4">Una aplicación web para explorar y gestionar datos sobre vinos argentinos.</p>
                    <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-full">Web App</span>
                </a>
                <a href="https://github.com/FaMatias/Stock-de-Vinos-Ex-ticos" target="_blank" class="card block p-6 rounded-2xl hover:shadow-sky-400/20">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">Stock de Vinos Exóticos</h3>
                    <p class="text-slate-400 mb-4">Plataforma de gestión de stock para una colección de vinos especializados.</p>
                    <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-full">Web App</span>
                </a>
                <a href="https://famatias.github.io/Simple-Links/index.html" target="_blank" class="card block p-6 rounded-2xl hover:shadow-sky-400/20">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">Simple-Links</h3>
                    <p class="text-slate-400 mb-4">Una página de enlaces personalizada para perfiles sociales.</p>
                    <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-full">Web App</span>
                </a>
                <a href="https://famatias.github.io/Simple-Links/practicas.html" target="_blank" class="card block p-6 rounded-2xl hover:shadow-sky-400/20">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">Pizarra Colaborativa</h3>
                    <p class="text-slate-400 mb-4">Aplicación de pizarra en tiempo real para trabajo en equipo.</p>
                    <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-full">Web App</span>
                </a>
                <a href="https://famatias.github.io/Simple-Links/practicas.html" target="_blank" class="card block p-6 rounded-2xl hover:shadow-sky-400/20">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">Tablero Kanban</h3>
                    <p class="text-slate-400 mb-4">Herramienta para organizar tareas en un tablero visual.</p>
                    <span class="inline-block bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-full">Web App</span>
                </a>
            </div>
        </section>
        <div class="h-1 bg-slate-800 w-full"></div>

        <!-- Sección de Herramientas de IA -->
        <section id="ia-hub" class="py-12 md:py-24 text-center px-4">
            <h2 class="text-3xl md:text-4xl font-extrabold text-sky-400 mb-8">IA Hub: Herramientas de Vanguardia</h2>
            <p class="text-slate-400 max-w-2xl mx-auto mb-8">
                Demuestra el poder de la inteligencia artificial. Mis proyectos pueden incluir funciones como estas para generar valor, optimizar tareas o crear contenido único.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <!-- Herramienta 1: Generador de Imágenes -->
                <div class="card p-8 rounded-3xl hover:shadow-sky-400/20">
                    <h3 class="text-2xl font-bold text-slate-100 mb-4">Generador de Imágenes</h3>
                    <p class="text-slate-400 mb-4">
                        Describe la imagen que quieres crear. ¡Ideal para tener ideas para un logo, banner o imagen de producto!
                    </p>
                    <input type="text" id="image-prompt" placeholder="Ej. un robot cocinando pizza en un restaurante elegante" required class="w-full p-4 rounded-xl border-2 border-slate-700 bg-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all shadow-sm text-slate-200 placeholder-slate-400 mb-4">
                    <button type="button" id="generate-image-btn" class="main-btn w-full">
                        <i class="fas fa-image mr-2"></i>Generar Imagen
                    </button>
                    <div id="image-container" class="mt-8 flex justify-center items-center h-64 bg-slate-800 rounded-xl border border-slate-700">
                        <img id="generated-image" class="max-h-full max-w-full rounded-xl object-contain hidden" alt="Imagen generada por IA">
                        <div id="image-loader" class="text-sky-400 hidden"><i class="fas fa-sync fa-spin fa-2x"></i></div>
                        <p id="image-placeholder" class="text-slate-500">La imagen generada aparecerá aquí.</p>
                    </div>
                </div>

                <!-- Herramienta 2: Generador de Descripciones para E-commerce -->
                <div class="card p-8 rounded-3xl hover:shadow-sky-400/20">
                    <h3 class="text-2xl font-bold text-slate-100 mb-4">Generador de Descripciones</h3>
                    <p class="text-slate-400 mb-4">
                        Escribe el nombre de tu producto y sus características. La IA creará una descripción optimizada para ventas.
                    </p>
                    <input type="text" id="product-name" placeholder="Nombre del Producto (ej. Auriculares inalámbricos Z1)" required class="w-full p-4 rounded-xl border-2 border-slate-700 bg-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all shadow-sm text-slate-200 placeholder-slate-400 mb-2">
                    <textarea id="product-features" rows="4" placeholder="Características (ej. Cancelación de ruido, batería de 20h, Bluetooth 5.2)" required class="w-full p-4 rounded-xl border-2 border-slate-700 bg-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all shadow-sm text-slate-200 placeholder-slate-400"></textarea>
                    <button type="button" id="generate-description-btn" class="main-btn w-full mt-4">
                        <i class="fas fa-file-alt mr-2"></i>Generar Descripción
                    </button>
                    <div id="description-container" class="mt-8 p-4 bg-slate-800 rounded-xl border border-slate-700 h-64 overflow-y-auto">
                        <p id="description-result" class="text-slate-400">La descripción del producto aparecerá aquí.</p>
                        <div id="description-loader" class="text-sky-400 hidden text-center"><i class="fas fa-sync fa-spin fa-2x"></i></div>
                    </div>
                </div>
            </div>
        </section>
        <div class="h-1 bg-slate-800 w-full"></div>

        <!-- Sección de Contacto con formulario -->
        <section id="contacto" class="py-12 md:py-24 text-center px-4">
            <h2 class="text-3xl md:text-4xl font-extrabold text-sky-400 mb-8">Pide tu Presupuesto</h2>
            <p class="text-slate-400 max-w-2xl mx-auto mb-8">
                ¿Tienes una idea o necesitas ayuda con tu proyecto digital? No dudes en contactarme. Estoy listo para ayudarte a crear algo increíble.
            </p>
            <div class="max-w-xl mx-auto p-8 card rounded-3xl hover:shadow-sky-400/20">
                <form id="contact-form" class="space-y-6">
                    <div>
                        <input type="text" id="nombre" name="nombre" placeholder="Tu Nombre" required class="w-full p-4 rounded-xl border-2 border-slate-700 bg-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all shadow-sm text-slate-200 placeholder-slate-400">
                    </div>
                    <div>
                        <input type="email" id="email" name="email" placeholder="Tu Email" required class="w-full p-4 rounded-xl border-2 border-slate-700 bg-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all shadow-sm text-slate-200 placeholder-slate-400">
                    </div>
                    <div>
                        <textarea id="mensaje" name="mensaje" rows="4" placeholder="Describe tu proyecto" required class="w-full p-4 rounded-xl border-2 border-slate-700 bg-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all shadow-sm text-slate-200 placeholder-slate-400"></textarea>
                    </div>
                    <button type="button" id="analyze-project-btn" class="main-btn w-full mt-4">
                        <i class="fas fa-magic mr-2"></i>✨ Analizar Proyecto ✨
                    </button>
                    <button type="submit" class="w-full main-btn mt-2 bg-slate-700 text-slate-200 hover:bg-slate-600 transition-colors duration-300 transform hover:scale-105">
                        Enviar Presupuesto
                    </button>
                </form>
                <div class="flex items-center justify-center space-x-6 mt-8">
                    <a href="https://www.linkedin.com/in/fabricio-matias-toso/" target="_blank" class="text-slate-400 hover:text-sky-400 transition-colors">
                        <i class="fab fa-linkedin fa-2x"></i>
                    </a>
                    <a href="#" class="text-slate-400 hover:text-sky-400 transition-colors">
                        <i class="fab fa-github fa-2x"></i>
                    </a>
                    <a href="#" class="text-slate-400 hover:text-sky-400 transition-colors">
                        <i class="fab fa-twitter fa-2x"></i>
                    </a>
                    <a href="https://www.instagram.com/fa.matias/" target="_blank" class="text-slate-400 hover:text-sky-400 transition-colors">
                        <i class="fab fa-instagram fa-2x"></i>
                    </a>
                </div>
            </div>
        </section>

        <!-- Pie de página -->
        <footer class="text-center text-slate-500 mt-16 py-4 border-t border-slate-800">
            <p>&copy; 2024 Fabricio Matías Toso. Todos los derechos reservados.</p>
        </footer>
    </div>

    <!-- Message Box for success/error messages -->
    <div id="messageBox" class="message-box bg-emerald-500 text-white p-4 rounded-xl shadow-lg">
        <p id="messageText"></p>
    </div>

    <!-- Modal para la respuesta del analizador de proyectos -->
    <div id="apiResponseModal" class="api-response-box p-6 rounded-xl shadow-lg bg-slate-900 border-2 border-sky-400/20">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold text-sky-400">Análisis de Proyecto</h3>
            <button id="closeModalBtn" class="text-slate-400 hover:text-sky-400 transition-colors text-3xl font-light">&times;</button>
        </div>
        <div id="apiResponseContent" class="prose text-slate-400 max-h-[calc(100vh-200px)] overflow-y-auto">
            <!-- El contenido generado por la IA se inyectará aquí -->
        </div>
    </div>

    <!-- Script principal para las animaciones y APIs -->
    <script>
        window.onload = function() {
            // Lógica para mostrar mensajes de éxito/error (no alerts)
            function showMessage(text, type = 'success', duration = 3000) {
                const messageBox = document.getElementById('messageBox');
                const messageText = document.getElementById('messageText');
                messageText.textContent = text;
                messageBox.className = 'message-box p-4 rounded-xl shadow-lg';
                if (type === 'error') {
                    messageBox.classList.add('bg-rose-500', 'text-white');
                } else {
                    messageBox.classList.add('bg-emerald-500', 'text-white');
                }
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, duration);
            }

            // Lógica del efecto de escritura en la sección Hero
            function startTypingEffect() {
                const typingElement = document.getElementById('typing-effect');
                // Se actualizó para reflejar el cambio a "Biotecnólogo"
                const phrases = ["Desarrollador Web", "Biotecnólogo", "Especialista en WordPress", "Creador de Soluciones Digitales"];
                let phraseIndex = 0;
                let letterIndex = 0;
                let isDeleting = false;
                let delay = 100;

                function type() {
                    const currentPhrase = phrases[phraseIndex];
                    if (isDeleting) {
                        typingElement.textContent = currentPhrase.substring(0, letterIndex - 1);
                        letterIndex--;
                    } else {
                        typingElement.textContent = currentPhrase.substring(0, letterIndex + 1);
                        letterIndex++;
                    }

                    if (!isDeleting && letterIndex === currentPhrase.length) {
                        delay = 2000;
                        isDeleting = true;
                    } else if (isDeleting && letterIndex === 0) {
                        isDeleting = false;
                        phraseIndex = (phraseIndex + 1) % phrases.length;
                        delay = 500;
                    } else {
                        delay = isDeleting ? 50 : 100;
                    }
                    setTimeout(type, delay);
                }
                type();
            }
            startTypingEffect();

            // Lógica del formulario de contacto
            const contactForm = document.getElementById('contact-form');
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                showMessage("¡Gracias por tu mensaje! Me pondré en contacto contigo pronto.");
                contactForm.reset();
            });

            // Gemini API: Analizador de Proyectos
            const analyzeProjectBtn = document.getElementById('analyze-project-btn');
            const mensajeTextarea = document.getElementById('mensaje');
            const apiResponseModal = document.getElementById('apiResponseModal');
            const apiResponseContent = document.getElementById('apiResponseContent');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const analyzeButtonText = analyzeProjectBtn.innerHTML;

            function showResponseModal(content) {
                apiResponseContent.innerHTML = content;
                apiResponseModal.style.display = 'block';
            }

            closeModalBtn.addEventListener('click', () => {
                apiResponseModal.style.display = 'none';
            });
            window.addEventListener('click', (e) => {
                if (e.target === apiResponseModal) {
                    apiResponseModal.style.display = 'none';
                }
            });

            analyzeProjectBtn.addEventListener('click', async () => {
                const prompt = mensajeTextarea.value.trim();
                if (!prompt) {
                    showMessage("Por favor, describe tu proyecto primero.", 'error');
                    return;
                }
                analyzeProjectBtn.innerHTML = '<i class="fas fa-sync fa-spin mr-2"></i> Analizando...';
                analyzeProjectBtn.disabled = true;

                const llmPrompt = `Actúa como un consultor de desarrollo web experimentado. El usuario te ha descrito una idea de proyecto. Analiza la descripción, resume los puntos clave, sugiere una posible pila de tecnologías (ej. React, Node.js, MongoDB) y ofrece un plan de acción de alto nivel. Aquí está la descripción del proyecto: "${prompt}"`;
                let retryCount = 0;
                const maxRetries = 3;
                let backoffTime = 1000;

                async function callGeminiApi() {
                    try {
                        const chatHistory = [{ role: "user", parts: [{ text: llmPrompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 && retryCount < maxRetries) {
                                await new Promise(resolve => setTimeout(resolve, backoffTime));
                                backoffTime *= 2;
                                retryCount++;
                                return callGeminiApi();
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            const formattedText = text.replace(/^### (.*)$/gm, '<h3>$1</h3>')
                                                      .replace(/^## (.*)$/gm, '<h2>$1</h2>')
                                                      .replace(/^# (.*)$/gm, '<h1>$1</h1>')
                                                      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                            showResponseModal(formattedText);
                        } else {
                            throw new Error("No se pudo obtener la respuesta de la API.");
                        }
                    } catch (error) {
                        console.error("Error al llamar a la API de Gemini:", error);
                        showMessage("Error al analizar el proyecto. Por favor, inténtalo de nuevo.", 'error');
                    } finally {
                        analyzeProjectBtn.innerHTML = analyzeButtonText;
                        analyzeProjectBtn.disabled = false;
                    }
                }
                callGeminiApi();
            });

            // Gemini API: Lector de Texto a Voz (TTS)
            const readAloudBtn = document.getElementById('read-aloud-btn');
            const filosofiaText = document.getElementById('filosofia-text');
            const audioPlayer = document.getElementById('audio-player');
            let isPlaying = false;
            let audioUrl = null;

            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }

            function pcmToWav(pcm16, sampleRate) {
                const buffer = new ArrayBuffer(44 + pcm16.byteLength);
                const view = new DataView(buffer);
                writeString(view, 0, 'RIFF');
                view.setUint32(4, 36 + pcm16.byteLength, true);
                writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, 1, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true);
                view.setUint16(34, 16, true);
                writeString(view, 36, 'data');
                view.setUint32(40, pcm16.byteLength, true);
                for (let i = 0; i < pcm16.length; i++) {
                    view.setInt16(44 + i * 2, pcm16[i], true);
                }
                return new Blob([view], { type: 'audio/wav' });

                function writeString(view, offset, string) {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                }
            }

            readAloudBtn.addEventListener('click', async () => {
                if (isPlaying) {
                    audioPlayer.pause();
                    isPlaying = false;
                    readAloudBtn.innerHTML = '<i class="fas fa-volume-up mr-2"></i>✨ Leer en voz alta ✨';
                    return;
                }

                if (audioUrl) {
                    audioPlayer.play();
                    isPlaying = true;
                    readAloudBtn.innerHTML = '<i class="fas fa-pause mr-2"></i> Detener';
                    return;
                }

                readAloudBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Cargando...';
                readAloudBtn.disabled = true;

                const textToSpeak = filosofiaText.innerText.replace(/\s+/g, ' ').trim();
                const prompt = `Say in a confident and professional tone: ${textToSpeak}`;
                let retryCount = 0;
                const maxRetries = 3;
                let backoffTime = 1000;

                async function callTtsApi() {
                    try {
                        const payload = {
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: {
                                responseModalities: ["AUDIO"],
                                speechConfig: {
                                    voiceConfig: { prebuiltVoiceConfig: { voiceName: "Rasalgethi" } }
                                }
                            }
                        };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                             if (response.status === 429 && retryCount < maxRetries) {
                                await new Promise(resolve => setTimeout(resolve, backoffTime));
                                backoffTime *= 2;
                                retryCount++;
                                return callTtsApi();
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        }

                        const result = await response.json();
                        const audioPart = result?.candidates?.[0]?.content?.parts?.[0];
                        if (audioPart && audioPart.inlineData) {
                            const pcmData = base64ToArrayBuffer(audioPart.inlineData.data);
                            const pcm16 = new Int16Array(pcmData);
                            const sampleRate = 24000;
                            const wavBlob = pcmToWav(pcm16, sampleRate);
                            
                            audioUrl = URL.createObjectURL(wavBlob);
                            audioPlayer.src = audioUrl;
                            audioPlayer.classList.remove('hidden');
                            audioPlayer.play();
                            isPlaying = true;
                            readAloudBtn.innerHTML = '<i class="fas fa-pause mr-2"></i> Detener';
                            audioPlayer.onended = () => {
                                isPlaying = false;
                                readAloudBtn.innerHTML = '<i class="fas fa-volume-up mr-2"></i>✨ Leer en voz alta ✨';
                            };
                        } else {
                            throw new Error("No se pudo obtener el audio de la API.");
                        }
                    } catch (error) {
                        console.error("Error al llamar a la API de TTS:", error);
                        showMessage("Error al generar el audio. Por favor, inténtalo de nuevo.", 'error');
                    } finally {
                        readAloudBtn.disabled = false;
                    }
                }
                callTtsApi();
            });

            // Gemini API: Generador de Imágenes (Modelo corregido)
            const generateImageBtn = document.getElementById('generate-image-btn');
            const imagePromptInput = document.getElementById('image-prompt');
            const generatedImage = document.getElementById('generated-image');
            const imageLoader = document.getElementById('image-loader');
            const imagePlaceholder = document.getElementById('image-placeholder');
            const generateButtonText = generateImageBtn.innerHTML;

            generateImageBtn.addEventListener('click', async () => {
                const prompt = imagePromptInput.value.trim();
                if (!prompt) {
                    showMessage("Por favor, ingresa una descripción para generar la imagen.", 'error');
                    return;
                }
                imagePlaceholder.style.display = 'none';
                generatedImage.style.display = 'none';
                imageLoader.style.display = 'block';
                generateImageBtn.innerHTML = '<i class="fas fa-sync fa-spin mr-2"></i> Generando...';
                generateImageBtn.disabled = true;

                let retryCount = 0;
                const maxRetries = 3;
                let backoffTime = 1000;

                async function callImageApi() {
                    try {
                        const payload = { instances: { prompt: prompt }, parameters: { "sampleCount": 1 } };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 && retryCount < maxRetries) {
                                await new Promise(resolve => setTimeout(resolve, backoffTime));
                                backoffTime *= 2;
                                retryCount++;
                                return callImageApi();
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        }

                        const result = await response.json();
                        if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                            const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                            generatedImage.src = imageUrl;
                            generatedImage.style.display = 'block';
                            imageLoader.style.display = 'none';
                        } else {
                            throw new Error("No se pudo generar la imagen.");
                        }
                    } catch (error) {
                        console.error("Error al llamar a la API de Imagen:", error);
                        imageLoader.style.display = 'none';
                        imagePlaceholder.style.display = 'block';
                        imagePlaceholder.textContent = 'Error al generar la imagen. Inténtalo de nuevo.';
                        showMessage("Error al generar la imagen. Inténtalo de nuevo.", 'error');
                    } finally {
                        generateImageBtn.innerHTML = generateButtonText;
                        generateImageBtn.disabled = false;
                    }
                }
                callImageApi();
            });

            // Gemini API: Generador de Descripciones para E-commerce
            const generateDescriptionBtn = document.getElementById('generate-description-btn');
            const productNameInput = document.getElementById('product-name');
            const productFeaturesTextarea = document.getElementById('product-features');
            const descriptionResult = document.getElementById('description-result');
            const descriptionLoader = document.getElementById('description-loader');
            const generateDescriptionButtonText = generateDescriptionBtn.innerHTML;

            generateDescriptionBtn.addEventListener('click', async () => {
                const productName = productNameInput.value.trim();
                const productFeatures = productFeaturesTextarea.value.trim();
                if (!productName || !productFeatures) {
                    showMessage("Por favor, ingresa el nombre del producto y sus características.", 'error');
                    return;
                }
                descriptionResult.textContent = '';
                descriptionLoader.style.display = 'block';
                generateDescriptionBtn.innerHTML = '<i class="fas fa-sync fa-spin mr-2"></i> Generando...';
                generateDescriptionBtn.disabled = true;

                const llmPrompt = `Actúa como un experto en marketing para e-commerce. Crea una descripción de producto atractiva y persuasiva para el siguiente artículo. Incluye el nombre del producto y las características clave. Usa un tono que incite a la compra.
                
                Nombre del producto: ${productName}
                Características: ${productFeatures}`;

                let retryCount = 0;
                const maxRetries = 3;
                let backoffTime = 1000;

                async function callDescriptionApi() {
                    try {
                        const chatHistory = [{ role: "user", parts: [{ text: llmPrompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 && retryCount < maxRetries) {
                                await new Promise(resolve => setTimeout(resolve, backoffTime));
                                backoffTime *= 2;
                                retryCount++;
                                return callDescriptionApi();
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            descriptionResult.textContent = text;
                        } else {
                            throw new Error("No se pudo obtener la descripción de la API.");
                        }
                    } catch (error) {
                        console.error("Error al llamar a la API de Gemini:", error);
                        descriptionResult.textContent = "Error al generar la descripción. Inténtalo de nuevo.";
                        showMessage("Error al generar la descripción. Por favor, inténtalo de nuevo.", 'error');
                    } finally {
                        descriptionLoader.style.display = 'none';
                        generateDescriptionBtn.innerHTML = generateDescriptionButtonText;
                        generateDescriptionBtn.disabled = false;
                    }
                }
                callDescriptionApi();
            });
        };
    </script>
</body>
</html>
